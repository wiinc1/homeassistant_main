- id: '1696381624866'
  alias: Lights - Basement Motion
  description: 'Turns on basement lights when motion is detected, turns off when occupancy clears'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.lumi_lumi_motion_ac02_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: state
      entity_id: input_boolean.automation_enabled
      state: 'on'
    - condition: not
      conditions:
        - condition: state
          entity_id: media_player.basement_tv
          state: 'playing'
    - condition: template
      value_template: "{{ not is_state('binary_sensor.lumi_lumi_motion_ac02_motion', 'unavailable') and not is_state('binary_sensor.lumi_lumi_motion_ac02_motion', 'unknown') }}"
  action:
    - if:
        - condition: template
          value_template: >
            {{ not is_state('light.basement_familyroom_light', 'unavailable') and
               not is_state('light.basement_familyroom_light', 'unknown') and
               not is_state('light.basementhallwaylight', 'unavailable') and
               not is_state('light.basementhallwaylight', 'unknown') }}
      then:
        - service: light.turn_on
          target:
            entity_id:
              - light.basement_familyroom_light
              - light.basementhallwaylight
    - if:
        - condition: state
          entity_id: binary_sensor.lumi_lumi_motion_ac02_occupancy
          state: 'off'
      then:
        - service: light.turn_off
          target:
            entity_id:
              - light.basement_familyroom_light
              - light.basementhallwaylight
  mode: single
  max_exceeded: silent