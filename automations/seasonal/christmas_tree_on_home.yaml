- id: 'christmas_tree_on_home'
  alias: "Christmas Tree - Turn On When Home"
  description: 'Turns on Christmas tree lights when family members arrive home during daytime hours'
  trigger:
    - platform: state
      entity_id: 
        - device_tracker.kathryn_phone
        - device_tracker.madelyn_phone
      to: 'home'
      from: 'not_home'
  condition:
    - condition: state
      entity_id: input_boolean.automation_enabled
      state: 'on'
    - condition: time
      after: '07:00:00'
      before: '22:30:00'
    - condition: template
      value_template: >
        {{ not is_state('switch.upstairsfamilyroomchristmastree', 'unavailable') and
           not is_state('switch.upstairsfamilyroomchristmastree', 'unknown') and
           not is_state('switch.basementchristmastree', 'unavailable') and
           not is_state('switch.basementchristmastree', 'unknown') }}
    - condition: state
      entity_id: binary_sensor.vacation_mode_active
      state: 'off'
  action:
    - if:
        condition: or
        conditions:
          - condition: state
            entity_id: switch.upstairsfamilyroomchristmastree
            state: 'off'
          - condition: state
            entity_id: switch.basementchristmastree
            state: 'off'
      then:
        - service: switch.turn_on
          target:
            entity_id: 
              - switch.upstairsfamilyroomchristmastree
              - switch.basementchristmastree
  mode: single